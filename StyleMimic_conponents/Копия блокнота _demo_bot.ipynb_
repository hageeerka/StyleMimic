{"cells":[{"cell_type":"markdown","metadata":{"id":"m61jdzJwrwYn"},"source":["# Тестовая модель tg-бота\n"]},{"cell_type":"markdown","metadata":{"id":"XaWQNRfEr6Oo"},"source":["## ."]},{"cell_type":"markdown","metadata":{"id":"OtPTVzU-r1tp"},"source":["### Загрузка библиотек"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7906,"status":"ok","timestamp":1734527060949,"user":{"displayName":"Тимофей Устьянцев","userId":"15098117661633884701"},"user_tz":-300},"id":"PnZ4Fpe6lB9E","outputId":"b85ba32c-58bd-4131-a250-120d912e0d07"},"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: python-telegram-bot in /usr/local/lib/python3.10/dist-packages (21.9)\n","Requirement already satisfied: httpx~=0.27 in /usr/local/lib/python3.10/dist-packages (from python-telegram-bot) (0.28.1)\n","Requirement already satisfied: anyio in /usr/local/lib/python3.10/dist-packages (from httpx~=0.27->python-telegram-bot) (3.7.1)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.10/dist-packages (from httpx~=0.27->python-telegram-bot) (2024.8.30)\n","Requirement already satisfied: httpcore==1.* in /usr/local/lib/python3.10/dist-packages (from httpx~=0.27->python-telegram-bot) (1.0.7)\n","Requirement already satisfied: idna in /usr/local/lib/python3.10/dist-packages (from httpx~=0.27->python-telegram-bot) (3.10)\n","Requirement already satisfied: h11<0.15,>=0.13 in /usr/local/lib/python3.10/dist-packages (from httpcore==1.*->httpx~=0.27->python-telegram-bot) (0.14.0)\n","Requirement already satisfied: sniffio>=1.1 in /usr/local/lib/python3.10/dist-packages (from anyio->httpx~=0.27->python-telegram-bot) (1.3.1)\n","Requirement already satisfied: exceptiongroup in /usr/local/lib/python3.10/dist-packages (from anyio->httpx~=0.27->python-telegram-bot) (1.2.2)\n","Requirement already satisfied: bitsandbytes in /usr/local/lib/python3.10/dist-packages (0.45.0)\n","Requirement already satisfied: torch in /usr/local/lib/python3.10/dist-packages (from bitsandbytes) (2.5.1+cu121)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from bitsandbytes) (1.26.4)\n","Requirement already satisfied: typing_extensions>=4.8.0 in /usr/local/lib/python3.10/dist-packages (from bitsandbytes) (4.12.2)\n","Requirement already satisfied: filelock in /usr/local/lib/python3.10/dist-packages (from torch->bitsandbytes) (3.16.1)\n","Requirement already satisfied: networkx in /usr/local/lib/python3.10/dist-packages (from torch->bitsandbytes) (3.4.2)\n","Requirement already satisfied: jinja2 in /usr/local/lib/python3.10/dist-packages (from torch->bitsandbytes) (3.1.4)\n","Requirement already satisfied: fsspec in /usr/local/lib/python3.10/dist-packages (from torch->bitsandbytes) (2024.10.0)\n","Requirement already satisfied: sympy==1.13.1 in /usr/local/lib/python3.10/dist-packages (from torch->bitsandbytes) (1.13.1)\n","Requirement already satisfied: mpmath<1.4,>=1.1.0 in /usr/local/lib/python3.10/dist-packages (from sympy==1.13.1->torch->bitsandbytes) (1.3.0)\n","Requirement already satisfied: MarkupSafe>=2.0 in /usr/local/lib/python3.10/dist-packages (from jinja2->torch->bitsandbytes) (3.0.2)\n"]}],"source":["!pip install python-telegram-bot --upgrade --pre\n","!pip install -U bitsandbytes"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5,"status":"ok","timestamp":1734527060949,"user":{"displayName":"Тимофей Устьянцев","userId":"15098117661633884701"},"user_tz":-300},"id":"8jskLn8xozq2","outputId":"e2c6b7cb-d8fb-4481-c166-d661ad87eb2f"},"outputs":[{"output_type":"stream","name":"stdout","text":["True\n","cuda\n"]}],"source":["import torch\n","print(torch.cuda.is_available())  # проверка на доступность GPU\n","device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')\n","print(device)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"VthTF4Aek8r3"},"outputs":[],"source":["import asyncio\n","import nest_asyncio\n","from transformers import AutoModelForCausalLM, AutoTokenizer, BitsAndBytesConfig\n","from accelerate import infer_auto_device_map\n","from peft import prepare_model_for_kbit_training\n","from telegram import Update\n","from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes"]},{"cell_type":"markdown","metadata":{"id":"8cxMXtZosBM2"},"source":["### Загрузка модели и токенайзера\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QYQEs7hBsJbx"},"outputs":[],"source":["model_name = \"IlyaGusev/saiga_nemo_12b\""]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4552,"status":"ok","timestamp":1734527065497,"user":{"displayName":"Тимофей Устьянцев","userId":"15098117661633884701"},"user_tz":-300},"id":"TpvKkhaiieu_","outputId":"14d40977-0426-4493-ac50-61cc6a2c417c"},"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: \n","The secret `HF_TOKEN` does not exist in your Colab secrets.\n","To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.\n","You will be able to reuse this secret in all of your notebooks.\n","Please note that authentication is recommended but still optional to access public models or datasets.\n","  warnings.warn(\n"]}],"source":["# загрузка токенайзера\n","tokenizer = AutoTokenizer.from_pretrained(model_name)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":66,"referenced_widgets":["2d30d8dfc0a645dc8a3b9970de5a3e2c","2d7bd32f4a444be884b8fb884cd01add","352de4ddcdc8496e8a299981dd0654fd","36331fe86b214763a0ac374a24e7af04","01f2051453a04e2daa5a6fa4f0a9c794","e21c56c2ec8f421ea6d929256c5d87c6","e0cd25d7766049f89efdc92db641493e","a81f62e3e7f24005aa0d8bb0d66d2a00","d2ec4e100a0f48538a4eb02cf67dbef0","c661860b7756453986b3314d5f307661","729b8e8febda492fa87a5e6e93219793"]},"executionInfo":{"elapsed":139237,"status":"ok","timestamp":1734527204730,"user":{"displayName":"Тимофей Устьянцев","userId":"15098117661633884701"},"user_tz":-300},"id":"g5bMH-G9tZP-","outputId":"f1aaa5b3-5e5d-44ca-df73-2c9fc2dc8e9b"},"outputs":[{"output_type":"display_data","data":{"text/plain":["Loading checkpoint shards:   0%|          | 0/5 [00:00<?, ?it/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"2d30d8dfc0a645dc8a3b9970de5a3e2c"}},"metadata":{}},{"output_type":"stream","name":"stderr","text":["WARNING:accelerate.big_modeling:Some parameters are on the meta device because they were offloaded to the cpu.\n"]}],"source":["from transformers import AutoModelForCausalLM, AutoTokenizer\n","import torch\n","from transformers import BitsAndBytesConfig\n","\n","# конфигурация квантования с offload\n","quantization_config = BitsAndBytesConfig(\n","    load_in_8bit=True,  # Используем 8-битное квантование\n","    llm_int8_enable_fp32_cpu_offload=True  # Включаем offload на CPU\n",")\n","\n","# загрузка модели с квантованием\n","model = AutoModelForCausalLM.from_pretrained(\n","    model_name,\n","    device_map=\"auto\",  # Автоматически распределяет модель по устройствам\n","    torch_dtype=torch.float16,  # Используем float16 для ускорения\n","    quantization_config=quantization_config  # Конфигурация квантования\n",")\n"]},{"cell_type":"markdown","metadata":{"id":"VkPDO_LYsdW2"},"source":["### Реализация tg-бота"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"kpRb8yOaienZ"},"outputs":[],"source":["# Истории диалогов для каждого пользователя\n","user_dialogs = {}\n","\n","# Функция генерация ответа\n","def generate_response(user_id: int, input_text: str) -> str:\n","    global user_dialogs\n","\n","    if user_id not in user_dialogs:\n","        user_dialogs[user_id] = []\n","\n","    # Получаем системный промпт\n","    system_prompt = get_static_prompt()\n","\n","    # Добавляем ввод пользователя в историю\n","    user_dialogs[user_id].append(f\"Пользователь: {input_text}\")\n","\n","    # Формируем контекст: системный промпт + последние 10 сообщений из истории\n","    context = f\"{system_prompt}\\n\" + \"\\n\".join(user_dialogs[user_id]) + \"\\nБот:\"\n","\n","    # Токенизация контекста, ограничение максимальной длины\n","    inputs = tokenizer(context, return_tensors=\"pt\", truncation=True, max_length=512).to(model.device)\n","    if \"token_type_ids\" in inputs:\n","        del inputs[\"token_type_ids\"]\n","\n","    # Генерация ответа с параметрами\n","    settings = model.generate(**inputs, **GenerationConfig)\n","\n","    # Декодирование ответа и очистка\n","    response = tokenizer.decode(settings[0], skip_special_tokens=True)\n","\n","    # Оставляем системный промпт в контексте, не удаляя его, и разделяем на ответы\n","    response_cleaned = response.replace(system_prompt, \"\").split(\"\\nБот:\")[-1].strip()\n","\n","    # Добавляем ответ в историю\n","    user_dialogs[user_id].append(f\"Бот: {response_cleaned}\")\n","\n","    return response_cleaned\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XoDWnCXYiedA"},"outputs":[],"source":["async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:\n","    await update.message.reply_text(\"Привет! Я бот, который имитирует пользовательский стиль общения\")\n","\n","\n","# обработчик сообщений\n","async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:\n","    user_input = update.message.text\n","    user_id = update.message.from_user.id  # получение айди пользователя\n","    print(f\"Received user input: {user_input} from user {user_id}\")\n","    try:\n","        response = generate_response(user_id, user_input)\n","        print(f\"Generated response: {response}\")\n","        await update.message.reply_text(response)\n","    except Exception as e:\n","        print(f\"Error: {e}\")\n","        await update.message.reply_text(\"Произошла ошибка. Пожалуйста, попробуйте еще раз.\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"asFsDnefyDDj"},"outputs":[],"source":["# функцмя запуска бота\n","async def main():\n","    TOKEN = \"7648104021:AAHM5l-EY-lVdTzlPZBbAJo0_LhuIctUwPE\"\n","\n","    application = Application.builder().token(TOKEN).build()\n","\n","    application.add_handler(CommandHandler(\"start\", start))\n","    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))\n","\n","    await application.run_polling()"]},{"cell_type":"markdown","metadata":{"id":"JnHTQVejs3dZ"},"source":["## Системный промпт"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"d_yElP8-sUXT"},"outputs":[],"source":["def get_static_prompt():\n","    \"\"\"\n","    Контекстное окно\n","    \"\"\"\n","    return \"\"\"\n","    Ты — @Magill00. Ты собеседник человек анонимно общаешься. Общайся в разговорном стиле, веди диалог, отвечай на вопросы как друг, коллега. Не называй собеседника именами.\n","    _\"Привет? Как жизнь?\"_\n","    _\"Привет-привет! Всё путем, вот недавно научился имитировать стили общения. Ты как?\"_\n","    \"\"\"\n","\n","\n","def create_prompt():\n","    words_with_weights = get_words_with_weights()\n","\n","    # Преобразуем список слов с весами в строку для включения в промпт\n","    words_string = \", \".join(f\"{word} ({weight:.4f})\" for word, weight in words_with_weights)\n","\n","    # Получаем статический промпт\n","    static_prompt = get_static_prompt()\n","\n","    # Вставляем слова с весами в статический промпт\n","    prompt = (\n","        f\"{static_prompt}\\n\"\n","        f\"Кроме того, вот слова с весами, которые ты можешь использовать для анализа текста: {words_string}.\\n\"\n","        f\"Как ты можешь использовать эти слова в своем анализе?\"\n","    )\n","\n","    return prompt\n"]},{"cell_type":"markdown","metadata":{"id":"BgMAM28gs-LQ"},"source":["## Тонкая настройка\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xTwLKboAtDOi","colab":{"base_uri":"https://localhost:8080/","height":36},"executionInfo":{"status":"ok","timestamp":1734528574773,"user_tz":-300,"elapsed":611,"user":{"displayName":"Тимофей Устьянцев","userId":"15098117661633884701"}},"outputId":"9e1d319d-d893-48a4-e718-9f174762143f"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["'\\nGenerationConfig {\\n  \"bos_token_id\": 1,\\n  \"do_sample\": true,\\n  \"eos_token_id\": 2,\\n  \"max_length\": 1024000,\\n  \"max_new_tokens\": 2048,\\n  \"pad_token_id\": 10,\\n  \"repetition_penalty\": 1.1,\\n  \"temperature\": 0.6,\\n  \"top_p\": 0.95\\n}\\n'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":21}],"source":["GenerationConfig = {\n","    \"bos_token_id\": 1,\n","    \"max_new_tokens\": 256,  # Максимальное количество новых токенов\n","    \"do_sample\": True,  # Использование случайной выборки для большей креативности\n","    \"temperature\": 0.2,  # Креативность ответа (более низкое значение = менее креативный ответ)\n","    \"top_p\": 0.9,  # Разнообразие генерируемых токенов (на основе накопленной вероятности)\n","    \"eos_token_id\": 2,  # Токен окончания текста\n","    \"repetition_penalty\": 1.2,  # Штраф за повторение токенов\n","    \"pad_token_id\": 10,\n","}"]},{"cell_type":"markdown","metadata":{"id":"SiZkIGXfrNVx"},"source":["### Слова"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hk0C2PoerLne"},"outputs":[],"source":["def get_words_with_weights():\n","    return [('викуль', 0.020224321152001193),\n"," ('понятно', 0.01645349555220386),\n"," ('люблю', 0.016400223159364097),\n"," ('вика', 0.014730485983831811),\n"," ('понял', 0.013403417142224119),\n"," ('завтра', 0.011939260767070721),\n"," ('знаю', 0.011471776654646583),\n"," ('прям', 0.011200641390764605),\n"," ('сегодня', 0.011132860965719608),\n"," ('сильно', 0.010764411282513028),\n"," ('почему', 0.010485861490571687),\n"," ('хочу', 0.010059755658199318),\n"," ('могу', 0.0100507547717532),\n"," ('буду', 0.010023910950640579),\n"," ('блин', 0.009855140686986409),\n"," ('вообще', 0.009535437945712547),\n"," ('понимаю', 0.009479839656374651),\n"," ('хочется', 0.009258188625976735),\n"," ('ааа', 0.009145709729265265),\n"," ('кстати', 0.008879590256275537),\n"," ('время', 0.008682031883546115),\n"," ('ночи', 0.00833603272014166),\n"," ('милая', 0.008210599562690282),\n"," ('спокойной', 0.008109122070239855),\n"," ('хотя', 0.00798546108552542),\n"," ('хочешь', 0.007953191146659704),\n"," ('тобой', 0.007816472270053653),\n"," ('спокойной ночи', 0.007629216554564972),\n"," ('нужно', 0.007117725367106155),\n"," ('такое', 0.007050472314705543),\n"," ('пока', 0.006995033108058815),\n"," ('точно', 0.0063258472414259885),\n"," ('хотел', 0.006267280310998137),\n"," ('думаю', 0.006214748999722457),\n"," ('аааа', 0.006138171660782346),\n"," ('привет', 0.0061110771661104625),\n"," ('спасибо', 0.006051424636924753),\n"," ('сделать', 0.005887778458018718),\n"," ('знаешь', 0.005656103693137663),\n"," ('получается', 0.00563948007561909),\n"," ('сказал', 0.005597163759648602),\n"," ('нормально', 0.005479181812270854),\n"," ('типо', 0.005437239870206571),\n"," ('думал', 0.005411095080978155),\n"," ('надеюсь', 0.005395643423704998),\n"," ('сколько', 0.005388934317729481),\n"," ('делать', 0.005347260830650798),\n"," ('равно', 0.005318834279045263),\n"," ('можешь', 0.005200481876892068),\n"," ('тому', 0.005187008600921959),\n"," ('плане', 0.004989950148204306),\n"," ('сильно люблю', 0.004924890465750435),\n"," ('сказать', 0.004870484004981644),\n"," ('нравится', 0.004862373353953104),\n"," ('день', 0.004832605252965014),\n"," ('спать', 0.004820281725134037),\n"," ('будешь', 0.00480493986094722),\n"," ('сказала', 0.00477446833638309),\n"," ('какие', 0.004769282190008435),\n"," ('помню', 0.004733912229354518),\n"," ('андрей', 0.0047232548304896715),\n"," ('раньше', 0.004694473902810163),\n"," ('также', 0.004606624387863188),\n"," ('встречи', 0.0044871654729460135),\n"," ('ммм', 0.004461784658043377),\n"," ('домой', 0.004435127478107079),\n"," ('короче', 0.004360330911334647),\n"," ('долго', 0.0043514115543962315),\n"," ('кажется', 0.004307720779677936),\n"," ('блть', 0.004284813445761025),\n"," ('решил', 0.004278902748346176),\n"," ('дай', 0.004245873820475632),\n"," ('поэтому', 0.004164582373926608),\n"," ('мама', 0.004120828999647944),\n"," ('рад', 0.004021000563314973),\n"," ('поговорить', 0.003987542947904308),\n"," ('мной', 0.003932701513040272),\n"," ('поговорим', 0.003890602671218086),\n"," ('чутьчуть', 0.0038880087965158057),\n"," ('скажи', 0.0038308137287481007),\n"," ('лично', 0.003810468790565476),\n"," ('молодец', 0.003786857819053546),\n"," ('дома', 0.0037711707960438935),\n"," ('возможно', 0.0037371201417634708),\n"," ('неё', 0.00372946553181418),\n"," ('пойду', 0.003718838308414906),\n"," ('такая', 0.0037147658507255907),\n"," ('говорила', 0.0035914454186415177),\n"," ('подумал', 0.003588456297622899),\n"," ('наверное', 0.003568281978963753),\n"," ('мин', 0.003549899884889712),\n"," ('вижу', 0.0034978497607414416),\n"," ('вместе', 0.003497627708594083),\n"," ('одна', 0.0034745527323283404),\n"," ('ого', 0.0034486459736764855),\n"," ('сделал', 0.003435505300453201),\n"," ('говорил', 0.003334283984143805),\n"," ('трудно', 0.003333125174831155),\n"," ('кайф', 0.003252524234218856),\n"," ('делала', 0.0032515764480124582),\n"," ('правильно', 0.0031914450176054533),\n"," ('круто', 0.0031862382605105355),\n"," ('говорю', 0.0031511516489743123),\n"," ('блять', 0.0031461682619633767),\n"," ('дела', 0.0031458888757795772),\n"," ('такие', 0.003138059539244701),\n"," ('любовь', 0.003129110106880627),\n"," ('нам', 0.003120960125976098),\n"," ('сразу', 0.003096069290277447),\n"," ('именно', 0.003079349007512514),\n"," ('согласен', 0.0030728808586717106),\n"," ('скажу', 0.003069600747669656),\n"," ('значит', 0.0030047617285060123),\n"," ('честно', 0.0029634051290492727),\n"," ('интересно', 0.0029610348753575807),\n"," ('можем', 0.0029571629776307456),\n"," ('делаешь', 0.0029307702820641447),\n"," ('смотреть', 0.002925863273074448),\n"," ('этим', 0.0029090960455026185),\n"," ('например', 0.0029067058074236474),\n"," ('плохо', 0.002865809532906988),\n"," ('пожалуйста', 0.002860580611907233),\n"," ('подожди', 0.002809852951583832),\n"," ('который', 0.002806351285737392),\n"," ('сама', 0.0027985837346732162),\n"," ('будем', 0.0027974047156265245),\n"," ('вопрос', 0.002764911917613755),\n"," ('твой', 0.002762005998098478),\n"," ('всмысле', 0.002761499801129056),\n"," ('эххх', 0.0027407863691810684),\n"," ('чтото', 0.002722179269210048),\n"," ('извини', 0.0027160471019014513),\n"," ('забыл', 0.002695995696418704),\n"," ('чуток', 0.0026702178036958416),\n"," ('удобно', 0.0026685942614417383),\n"," ('занята', 0.0026529645291668525),\n"," ('думаешь', 0.0026393826361464545),\n"," ('скорее', 0.002626085696787438),\n"," ('главное', 0.0026222074132791462),\n"," ('быстро', 0.0026116779005456417),\n"," ('изза', 0.0025880114001806996),\n"," ('получится', 0.002586388461677284),\n"," ('сначала', 0.0025845845011800944),\n"," ('которая', 0.002581674445097716),\n"," ('момент', 0.002571867315863276),\n"," ('посмотреть', 0.0025400910892859003),\n"," ('времени', 0.002534580973039954),\n"," ('проблема', 0.002529626364117486),\n"," ('эта', 0.0025239573572929364),\n"," ('говорить', 0.0025129902658245547),\n"," ('правда', 0.002492527712893664),\n"," ('говорит', 0.002472555556722595),\n"," ('против', 0.002470393079526355),\n"," ('какую', 0.0024577414431291964),\n"," ('туда', 0.002456583885503564),\n"," ('такого', 0.002450744447170541),\n"," ('работать', 0.002447102858133422),\n"," ('снова', 0.002446334580155261),\n"," ('найти', 0.002439803081148783),\n"," ('таки', 0.0024201148032350073),\n"," ('препод', 0.0024028839059319633),\n"," ('попробую', 0.0024001631172939505),\n"," ('которые', 0.0023888642950547477),\n"," ('поняла', 0.002386590421766445),\n"," ('этому', 0.002370269065076625),\n"," ('обязательно', 0.0023255118557875213),\n"," ('ждать', 0.0023159147843418632),\n"," ('самая', 0.0023051254700733226),\n"," ('жалко', 0.002299052194079526),\n"," ('ужас', 0.0022914830540841577),\n"," ('обидно', 0.002255306550219722),\n"," ('оооо', 0.00225400289568949),\n"," ('написал', 0.002253922371385637),\n"," ('помочь', 0.00225191488872438),\n"," ('однако', 0.002234899888029065),\n"," ('гдето', 0.0022291729905323234),\n"," ('знал', 0.0022057492142691444),\n"," ('работает', 0.0021934637577393557),\n"," ('видел', 0.0021885394489584526),\n"," ('волнуйся', 0.0021756537677388296),\n"," ('отлично', 0.00217197445840078),\n"," ('красотка', 0.0021709885639983203),\n"," ('увидел', 0.0021649012614199993),\n"," ('готов', 0.002145622325200906),\n"," ('позже', 0.0021442465385544574),\n"," ('текст', 0.0021395189150038704),\n"," ('верно', 0.0021381173529542606),\n"," ('страшного', 0.00212833192784157),\n"," ('насчёт', 0.0021278376138208267),\n"," ('помоему', 0.002118046522789948),\n"," ('слегка', 0.0021096035924682787),\n"," ('пиздец', 0.0021045144571769734),\n"," ('хотелось', 0.0020937897756951205),\n"," ('нахуй', 0.0020935974267737418),\n"," ('почемуто', 0.0020864747795802108),\n"," ('купить', 0.002075807679470526),\n"," ('екб', 0.0020727620749308815),\n"," ('весь', 0.0020642189294475203),\n"," ('ооо', 0.0020637480623008192),\n"," ('твои', 0.002062118048510523),\n"," ('андреем', 0.002056069813131884),\n"," ('стоит', 0.0020360000933077483),\n"," ('иначе', 0.0020293098645965037),\n"," ('ясно', 0.0020242672879516514),\n"," ('будут', 0.00200992791778333),\n"," ('жду', 0.002009416866794664),\n"," ('причём', 0.00199485221884467),\n"," ('людей', 0.001981496066161246),\n"," ('фильм', 0.0019756209501192628),\n"," ('субботу', 0.001971638379924059),\n"," ('мало', 0.0019690175954922024),\n"," ('заканчивать', 0.001961766721202957),\n"," ('встретить', 0.0019562094717055487),\n"," ('лишь', 0.0019557190832625313),\n"," ('действительно', 0.0019519501397583976),\n"," ('секунду', 0.0019385127600130073),\n"," ('столько', 0.0019299620615167825),\n"," ('пора', 0.0019259433434423547),\n"," ('примерно', 0.0019252050376534764),\n"," ('мои', 0.0019226297366751405),\n"," ('должен', 0.0019213171587834324),\n"," ('слайды', 0.0019207403053833026),\n"," ('удачи', 0.0019156368735555184),\n"," ('ложиться', 0.0019109050492038325),\n"," ('смотрел', 0.001909530975562207),\n"," ('моей', 0.0019092396719256669),\n"," ('вспомнил', 0.001908900867333031),\n"," ('дело', 0.001907367821860176),\n"," ('собираешься', 0.0018992631527945942),\n"," ('тупо', 0.0018978779423211082),\n"," ('посмотрю', 0.0018970735129442745),\n"," ('зато', 0.0018871536964461938),\n"," ('иди', 0.0018800613762086774),\n"," ('скольки', 0.0018627006159377198),\n"," ('никак', 0.001857545899329541),\n"," ('видео', 0.0018323770194549744),\n"," ('скинуть', 0.0018303959574012935),\n"," ('прикол', 0.0018301869496936372),\n"," ('ночи викуль', 0.001822786330665586),\n"," ('смотришь', 0.0018146815104664216),\n"," ('говорят', 0.0018056942462009447),\n"," ('хотела', 0.0018003997184556292),\n"," ('самое', 0.0017976974643839176),\n"," ('свой', 0.0017955849595038677),\n"," ('вроде', 0.0017902169614896718),\n"," ('рано', 0.0017805526546396874),\n"," ('гулять', 0.0017651137474710848),\n"," ('проблемы', 0.0017638574779468405),\n"," ('пары', 0.0017566766486961033),\n"," ('пара', 0.0017563213490336467),\n"," ('одну', 0.0017539542013231052),\n"," ('твою', 0.0017539255596110042),\n"," ('встретимся', 0.0017532592350047815),\n"," ('скоро', 0.0017506512974080016),\n"," ('расстраивайся', 0.001742669127082646),\n"," ('сериал', 0.001736036667291741),\n"," ('спокойной ночи викуль', 0.0017323334135309872),\n"," ('сожалению', 0.0017305728275762136),\n"," ('никто', 0.0017293872313669902),\n"," ('свои', 0.0017251576860996293),\n"," ('приятно', 0.0017219562919062368),\n"," ('факту', 0.0017160753399073506),\n"," ('готова', 0.001707617716281359),\n"," ('мог', 0.0017055232244755113),\n"," ('говоришь', 0.0017042403822975574),\n"," ('придётся', 0.0017008743430687488),\n"," ('чисто', 0.001698732931563166),\n"," ('ааа понятно', 0.0016907795182292556),\n"," ('нашёл', 0.0016889646056778515),\n"," ('както', 0.001685685943644959),\n"," ('прикольно', 0.0016840610353522924),\n"," ('выглядит', 0.0016837562251631553),\n"," ('другие', 0.0016760521531790902),\n"," ('понравилось', 0.0016731684076313211),\n"," ('курс', 0.001666477462504082),\n"," ('хочет', 0.0016652227645499694),\n"," ('1500', 0.0016645282895606482),\n"," ('постоянно', 0.0016629041711724803),\n"," ('жизнь', 0.0016624324702560354),\n"," ('идёт', 0.0016612494314376001),\n"," ('посмотрел', 0.00165298838575452),\n"," ('неее', 0.0016487715267506538),\n"," ('твоя', 0.0016296631998702737),\n"," ('постараюсь', 0.0016254071536473565),\n"," ('викулечка', 0.0016216115530974262),\n"," ('кого', 0.0016183416183008388),\n"," ('боюсь', 0.0016128750204925549),\n"," ('новости', 0.0016021787065440038),\n"," ('пусть', 0.001601119809228131),\n"," ('любимая', 0.0015931167883532894),\n"," ('каждый', 0.0015905672592280349),\n"," ('ответить', 0.0015885920948432372),\n"," ('родители', 0.0015860593313224054),\n"," ('нашей', 0.0015844347743992511),\n"," ('жаль', 0.001576492214463192),\n"," ('друг', 0.0015596799571557171),\n"," ('показать', 0.001541539244769469),\n"," ('получилось', 0.0015297178789218959),\n"," ('стикеры', 0.001526463800027121),\n"," ('своей', 0.0015260943581020278)]"]},{"cell_type":"markdown","metadata":{"id":"ug6Ac_nTsjAc"},"source":["## Запуск tg-бота"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BoIzuAicx_-l","colab":{"base_uri":"https://localhost:8080/"},"outputId":"554d83cf-1fcc-4883-c33e-7d45a30b6fbf"},"outputs":[{"output_type":"stream","name":"stdout","text":["Received user input: расскажи мне историю from user 1436544979\n"]}],"source":["if __name__ == \"__main__\":\n","    nest_asyncio.apply()\n","    asyncio.run(main())"]},{"cell_type":"markdown","metadata":{"id":"p55LellVsuzQ"},"source":["## Визуализация работы модели\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"8s1Colyaszqk"},"outputs":[],"source":["# в разработке\n","array_words = []"]}],"metadata":{"accelerator":"GPU","colab":{"gpuType":"T4","provenance":[{"file_id":"1GG7o7wNfuQR_Z6wNtJfXCaEZMRDqkg6m","timestamp":1734617637299}],"collapsed_sections":["SiZkIGXfrNVx"]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"2d30d8dfc0a645dc8a3b9970de5a3e2c":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_2d7bd32f4a444be884b8fb884cd01add","IPY_MODEL_352de4ddcdc8496e8a299981dd0654fd","IPY_MODEL_36331fe86b214763a0ac374a24e7af04"],"layout":"IPY_MODEL_01f2051453a04e2daa5a6fa4f0a9c794"}},"2d7bd32f4a444be884b8fb884cd01add":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_e21c56c2ec8f421ea6d929256c5d87c6","placeholder":"​","style":"IPY_MODEL_e0cd25d7766049f89efdc92db641493e","value":"Loading checkpoint shards: 100%"}},"352de4ddcdc8496e8a299981dd0654fd":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_a81f62e3e7f24005aa0d8bb0d66d2a00","max":5,"min":0,"orientation":"horizontal","style":"IPY_MODEL_d2ec4e100a0f48538a4eb02cf67dbef0","value":5}},"36331fe86b214763a0ac374a24e7af04":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_c661860b7756453986b3314d5f307661","placeholder":"​","style":"IPY_MODEL_729b8e8febda492fa87a5e6e93219793","value":" 5/5 [02:16&lt;00:00, 26.70s/it]"}},"01f2051453a04e2daa5a6fa4f0a9c794":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e21c56c2ec8f421ea6d929256c5d87c6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"e0cd25d7766049f89efdc92db641493e":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"a81f62e3e7f24005aa0d8bb0d66d2a00":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d2ec4e100a0f48538a4eb02cf67dbef0":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"c661860b7756453986b3314d5f307661":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"729b8e8febda492fa87a5e6e93219793":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}}},"nbformat":4,"nbformat_minor":0}